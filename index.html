<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>剩食平台</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>剩食平台</h1>
    </header>

    <section id="authForms">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="registerBtn">註冊</button>
        <button id="loginBtn">登入</button>
    </section>

    <section id="welcome" style="display:none;">
        <p id="welcomeText"></p>
        <button id="logoutBtn">登出</button>
    </section>

    <section id="upload" style="display:none;">
        <h2>上傳剩食資訊</h2>
        <button id="useMyLocationBtn">使用我的位置</button>
        <form id="foodForm">
            <input type="text" id="foodName" placeholder="食物名稱" required>
            <input type="text" id="foodLocation" placeholder="位置" required>
            <input type="file" id="foodImage" accept="image/*">
            <button type="submit">上傳</button>
        </form>
        <div id="featuredList"></div>
        <div id="foodList"></div>
    </section>

    <section id="map">
        <h2>剩食地圖</h2>
        <div id="mapid" style="height:400px;"></div>
    </section>

    <script src="js/main.js"></script>
    <input type="file" id="img" />
    <button onclick="upload()">上傳圖片</button>

    <div id="result"></div>

    <script>
    async function upload() {
        const file = document.getElementById("img").files[0];
        if (!file) return alert("請選擇圖片!");

        const form = new FormData();
        form.append("reqtype", "fileupload");
        form.append("userhash", ""); // 匿名即可
        form.append("fileToUpload", file);

        const res = await fetch("https://catbox.moe/user/api.php", {
            method: "POST",
            body: form
        });

        const url = await res.text(); // 圖片 URL，例如 https://files.catbox.moe/xxxxx.png

        document.getElementById("result").innerHTML = `
            <p>圖片已上傳！</p>
            <a href="${url}" target="_blank">${url}</a><br>
            <img src="${url}" style="max-width:200px; margin-top:10px;">
        `;
    }
    </script>

</body>
</html>
